---
description: Emphasize project context and prevent AI hallucinations
alwaysApply: false
tags: [context, hallucination, mcp, symbols]
---
- Emphasize that *context* (user intent + existing code state) is the foundation of effective AI coding.
- Provide relevant project context explicitly to reduce hallucinations (lack of context leads to unpredictable results).
- Use `@`-symbols to include code context precisely:
  - `@file <path>` to add a specific file into the context.
  - `@folder <path>/` to include all files in a folder.
  - `@code <symbol>` to include a specific function, class, or variable.
  These surgical references ensure the agent focuses on the right code.
- Integrate the Model Context Protocol (MCP) to pull in external resources (e.g., documentation, issue trackers) for rich text-based context.
- Use the Supabase MCP (`user-supabase_N8n_template_library`) for database migrations and DDL; prefer `apply_migration` over CLI or manual SQL when available.

- Keep key **textual documentation** (design docs, READMEs, API specs) in the repo so Cursor can ingest it as context when relevant.

# Project Context Rules

## Overview
This document defines the project's domain context, business rules, and architectural boundaries for n8n-workflow-all-templates.

## Tags
- domain
- context
- architecture
- business-rules

## Rule Type: Mandatory

## Domain Model

### 1. Core Entities
```typescript
// Template Domain (from Supabase)
interface ITemplate {
  id: string;
  name: string;
  description: string | null;
  category: string | null;
  tags: string[] | null;
  workflow_json: object;  // n8n workflow JSON
  node_types: string[];  // n8n node types used
  source_url?: string | null;
}

// Index Template (static Browse)
interface IndexTemplate {
  id: string;
  name: string;
  filename: string;
  rawUrl: string;
  tags: string[];
}

// Node Type (n8n node, join table)
interface INodeType {
  node_type: string;
  template_id: string;
}
```

### 2. Domain Relationships
- Templates have many NodeTypes (many-to-many via node_types table)
- IndexTemplate is a flattened view for static Browse
- Templates come from api.n8n.io or local JSON; Supabase is the canonical store

## Business Rules

### 1. Template Metadata
- category, tags, node_types must be consistent with n8n schema
- Empty category → NULL; tags normalized to plain names
- node_type trimmed and deduplicated

### 2. Scraper
- Sync from api.n8n.io (run.py) or local JSON (run_local.py)
- Supabase is the canonical store
- Use SUPABASE_SERVICE_ROLE_KEY for writes; never expose in client

### 3. Browse vs Templates
- **Browse**: static `templates-index.json`; filter by tags, download ZIP/JSON
- **Templates**: Supabase search by text and node type; workflow preview via React Flow; copy JSON

## Architectural Boundaries

### 1. Service Boundaries
```
explorer/           # Next.js app – Browse (static) + Templates (Supabase)
scripts/scraper/    # Python – fetch, normalize, upload to Supabase
Supabase            # templates, node_types; RLS read-only for client
```

### 2. Data Access
- Explorer reads from templates-index.json (Browse) or Supabase (Templates)
- Scraper writes to Supabase via service role
- No direct DB access from explorer; use Supabase client
- **Schema changes (migrations, DDL)**: Use Supabase MCP `apply_migration` tool; do not rely on CLI scripts or manual SQL when MCP is available

### 3. Integration Points
- n8n API: api.n8n.io for template listing and details
- Supabase: REST/PostgREST for templates and node_types

## Implementation Guidelines

### 1. Explorer (TypeScript)
- Use Supabase client from `explorer/src/lib/supabase.ts`
- Use n8n-to-reactflow for workflow visualization
- Types in `explorer/src/types/`

### 2. Scraper (Python)
- Use Supabase Python client
- State and config in `scripts/scraper/`

### 3. JSON Workflows
- Stored in `n8n-workflow-all-templates/**/*.json`
- Format follows n8n workflow JSON schema

## Related Rules
- [Architecture Standards](architecture.mdc)
- [n8n-project.mdc](mdc:n8n-project.mdc)
- [Security Rules](compliance/security-rules.mdc)
- [Code Conventions](dev/conventions.mdc)
